<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>react-redux学习笔记 | RuAn</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="react," />
  

  <meta name="description" content="这里记录react-redux的一些关键点，并不是做为redux的介绍，自己备忘用。">
<meta name="keywords" content="react">
<meta property="og:type" content="article">
<meta property="og:title" content="react-redux学习笔记">
<meta property="og:url" content="http://yoursite.com/2017/04/19/redux学习笔记/index.html">
<meta property="og:site_name" content="RuAn">
<meta property="og:description" content="这里记录react-redux的一些关键点，并不是做为redux的介绍，自己备忘用。">
<meta property="og:updated_time" content="2017-04-19T07:55:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="react-redux学习笔记">
<meta name="twitter:description" content="这里记录react-redux的一些关键点，并不是做为redux的介绍，自己备忘用。">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redux"><span class="toc-text">redux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#react-redux-Sample-Examples"><span class="toc-text">react-redux Sample Examples</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异步Action"><span class="toc-text">异步Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Middleware"><span class="toc-text">Middleware</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#react-thunk"><span class="toc-text">react-thunk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redux-promise"><span class="toc-text">redux-promise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ducks-modular-redux"><span class="toc-text">ducks-modular-redux</span></a></li></ol></li></ol></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-redux学习笔记" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">react-redux学习笔记</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.04.19</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>RuAn</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="http://www.forsigner.com/2017/04/19/redux学习笔记/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>这里记录react-redux的一些关键点，并不是做为redux的介绍，自己备忘用。</p>
<a id="more"></a>
<p>参考资源</p>
<ul>
<li><a href="https://github.com/reactjs/redux" target="_blank" rel="external">redux</a></li>
<li><a href="https://github.com/reactjs/react-router-redux" target="_blank" rel="external">react-router-redux</a></li>
<li><a href="https://github.com/erikras/ducks-modular-redux" target="_blank" rel="external">ducks-modular-redux</a></li>
<li><a href="https://github.com/goopscoop/ga-react-tutorial/tree/6-reduxActionsAndReducers" target="_blank" rel="external">ga-react-tutorial</a></li>
<li><a href="https://github.com/erikras/react-redux-universal-hot-example" target="_blank" rel="external">react-redux-universal-hot-example</a></li>
<li><a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="external">redux-saga</a></li>
<li><a href="https://www.zhihu.com/question/47995437?sort=created" target="_blank" rel="external">Redux有哪些最佳实践?</a></li>
</ul>
<h1 id="redux"><a href="#redux" class="headerlink" title="redux"></a><a href="http://redux.js.org/" target="_blank" rel="external">redux</a></h1><p>Redux是JavaScript应用程序的可预测状态容器。<a href="http://cn.redux.js.org/" target="_blank" rel="external">中文文档</a><br>You can use Redux together with React, or with any other view library.<br><a href="http://redux.js.org/docs/introduction/Ecosystem.html" target="_blank" rel="external">生态系统</a>：很好的redux资源</p>
<h3 id="react-redux-Sample-Examples"><a href="#react-redux-Sample-Examples" class="headerlink" title="react-redux Sample Examples"></a>react-redux Sample Examples</h3><p>实现容器组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// mapStateToProps</span></div><div class="line"><span class="keyword">const</span> getVisibleTodos = <span class="function">(<span class="params">todos, filter</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">switch</span> (filter) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_ALL'</span>:</div><div class="line">      <span class="keyword">return</span> todos</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">      <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> t.completed)</div><div class="line">    <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">      <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">t</span> =&gt;</span> !t.completed)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todos</span>: getVisibleTodos(state.todos, state.visibilityFilter)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// mapDispatchToProps</span></div><div class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onTodoClick</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">      dispatch(toggleTodo(id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Finally, we create the VisibleTodoList by calling connect() and passing these two functions:</span></div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> VisibleTodoList = connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(TodoList)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> VisibleTodoList</div></pre></td></tr></table></figure>
<p>bindActionCreators 包装action</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// actionCreators</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">inputChange</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: INPUT_CHANGED,</div><div class="line">    value</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// bind</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> todoActionCreators <span class="keyword">from</span> <span class="string">'./todoActionCreators'</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> counterActionCreators <span class="keyword">from</span> <span class="string">'./counterActionCreators'</span></div><div class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state.todos &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">todoActions</span>: bindActionCreators(todoActionCreators, dispatch),</div><div class="line">    <span class="attr">counterActions</span>: bindActionCreators(counterActionCreators, dispatch)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// or </span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">actions</span>: bindActionCreators(<span class="built_in">Object</span>.assign(&#123;&#125;, todoActionCreators, counterActionCreators), dispatch)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// or </span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> bindActionCreators(<span class="built_in">Object</span>.assign(&#123;&#125;, todoActionCreators, counterActionCreators), dispatch)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>mergeProps 使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 根据组件的 props 注入特定用户的 todos 并把 props.userId 传入到 action 中</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state.todos &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeProps</span>(<span class="params">stateProps, dispatchProps, ownProps</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, ownProps, &#123;</div><div class="line">    <span class="attr">todos</span>: stateProps.todos[ownProps.userId],</div><div class="line">    <span class="attr">addTodo</span>: <span class="function">(<span class="params">text</span>) =&gt;</span> dispatchProps.addTodo(ownProps.userId, text)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, actionCreators, mergeProps)(TodoApp)</div></pre></td></tr></table></figure>
<p>Store</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span></div><div class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"><span class="keyword">import</span> todoApp <span class="keyword">from</span> <span class="string">'./reducers'</span></div><div class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./components/App'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> store = createStore(todoApp)</div><div class="line"></div><div class="line">render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="异步Action"><a href="#异步Action" class="headerlink" title="异步Action"></a>异步Action</h3><ul>
<li>你可以使用 <a href="https://github.com/acdlite/redux-promise" target="_blank" rel="external">redux-promise</a> 或者 <a href="https://github.com/pburtchaell/redux-promise-middleware" target="_blank" rel="external">redux-promise-middleware</a> 来 dispatch Promise 来替代函数。</li>
<li>你可以使用 <a href="https://github.com/redux-observable/redux-observable" target="_blank" rel="external">redux-observable</a> 来 dispatch Observable。</li>
<li>你可以使用 <a href="https://github.com/yelouafi/redux-saga/" target="_blank" rel="external">redux-saga</a> 中间件来创建更加复杂的异步 action。</li>
<li>你可以使用 <a href="https://github.com/lelandrichardson/redux-pack" target="_blank" rel="external">redux-pack</a> 中间件 dispatch 基于 Promise 的异步 Action。</li>
<li>你甚至可以写一个自定义的 middleware 来描述 API 请求，就像这个 <a href="http://cn.redux.js.org/docs/introduction/Examples.html#real-world" target="_blank" rel="external">真实场景的案例</a> 中的做法一样。</li>
</ul>
<h3 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h3><p>在生态系统中，有几个比较常用的中间件。</p>
<h4 id="react-thunk"><a href="#react-thunk" class="headerlink" title="react-thunk"></a>react-thunk</h4><p>处理异步Action</p>
<p>Redux Thunk middleware allows you to write action creators that return a function instead of an action. The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. The inner function receives the store methods dispatch and getState as parameters.</p>
<p>An action creator that returns a function to perform asynchronous dispatch:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> INCREMENT_COUNTER = <span class="string">'INCREMENT_COUNTER'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: INCREMENT_COUNTER</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">incrementAsync</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="comment">// Yay! Can invoke sync or async actions with `dispatch`</span></div><div class="line">      dispatch(increment());</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>An action creator that returns a function to perform conditional dispatch:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">incrementIfOdd</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> &#123; counter &#125; = getState();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (counter % <span class="number">2</span> === <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dispatch(increment());</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.1.0版本后，还添加注入参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> store = createStore(</div><div class="line">  reducer,</div><div class="line">  applyMiddleware(thunk.withExtraArgument(api))</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// later</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchUser</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState, api</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// you can use api here</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="redux-promise"><a href="#redux-promise" class="headerlink" title="redux-promise"></a>redux-promise</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; isFSA &#125; <span class="keyword">from</span> <span class="string">'flux-standard-action'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPromise</span>(<span class="params">val</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> val &amp;&amp; <span class="keyword">typeof</span> val.then === <span class="string">'function'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseMiddleware</span>(<span class="params">&#123; dispatch &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="params">next</span> =&gt;</span> action =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (!isFSA(action)) &#123;</div><div class="line">      <span class="keyword">return</span> isPromise(action)</div><div class="line">        ? action.then(dispatch)</div><div class="line">        : next(action);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> isPromise(action.payload)</div><div class="line">      ? action.payload.then(</div><div class="line">          <span class="function"><span class="params">result</span> =&gt;</span> dispatch(&#123; ...action, <span class="attr">payload</span>: result &#125;),</div><div class="line">          error =&gt; &#123;</div><div class="line">            dispatch(&#123; ...action, <span class="attr">payload</span>: error, <span class="attr">error</span>: <span class="literal">true</span> &#125;);</div><div class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">          &#125;</div><div class="line">        )</div><div class="line">      : next(action);</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过中间件处理reducer中的promise payload.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// implicit promise</span></div><div class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'FOO'</span>,</div><div class="line">  <span class="attr">payload</span>: <span class="keyword">new</span> <span class="built_in">Promise</span>()</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// explicit promise</span></div><div class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'FOO'</span>,</div><div class="line">  <span class="attr">payload</span>: &#123;</div><div class="line">    <span class="attr">promise</span>: <span class="keyword">new</span> <span class="built_in">Promise</span>()</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="ducks-modular-redux"><a href="#ducks-modular-redux" class="headerlink" title="ducks-modular-redux"></a>ducks-modular-redux</h4><p>ducks modular主要是吧reducer封装起来，在component中调用无需写过多type等参数，只需调用方法。</p>
<p>例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">inputChange</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> dispatch(inputChange(value)),</div><div class="line">    <span class="attr">inputSubmit</span>: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(inputSubmit()),</div><div class="line">    <span class="attr">deleteListItem</span>: <span class="function">(<span class="params">i</span>) =&gt;</span> dispatch(deleteListItem(i)),</div><div class="line">    <span class="attr">listItemClick</span>: <span class="function">(<span class="params">i</span>) =&gt;</span> dispatch(listItemClick(i))</div><div class="line">  &#125;; <span class="comment">// here we're mapping actions to props</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(ToDoApp);</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">'./List'</span>;</div><div class="line"><span class="keyword">import</span> Input <span class="keyword">from</span> <span class="string">'./Input'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToDoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"></div><div class="line">  onInputChange = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.props.inputChange(event.target.value);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  onInputSubmit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</div><div class="line">    event.preventDefault();</div><div class="line">    <span class="keyword">this</span>.props.inputSubmit();</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  onListItemClick = <span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.props.listItemClick(i)</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  deleteListItem = <span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.props.deleteListItem(i)</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  render()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props)</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div className="row"&gt;</div><div class="line">        &lt;div className="col-md-8 col-md-offset-2"&gt;</div><div class="line">          &lt;div className="panel panel-default"&gt;</div><div class="line">            &lt;div className="panel-body"&gt;</div><div class="line">              &lt;h1&gt;My To Do App&lt;/h1&gt;</div><div class="line">              &lt;hr/&gt;</div><div class="line">              &lt;List</div><div class="line">                onClick=&#123;this.onListItemClick&#125;</div><div class="line">                listItems=&#123;this.props.toDoApp.list&#125;</div><div class="line">                deleteListItem=&#123;this.deleteListItem&#125;</div><div class="line">              /&gt;</div><div class="line">              &lt;Input</div><div class="line">                value=&#123;this.props.toDoApp.newToDo&#125;</div><div class="line">                onChange=&#123;this.onInputChange&#125;</div><div class="line">                onSubmit=&#123;this.onInputSubmit&#125;</div><div class="line">              /&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default ToDoApp;</div></pre></td></tr></table></figure>
<p>createActionDispathchers example</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a function which creates same-named action dispatchers from an object</div><div class="line"> * whose function properties are action creators. Any non-functions in the actionCreators</div><div class="line"> * object are ignored.</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> createActionDispatchers = <span class="function"><span class="params">actionCreators</span> =&gt;</span> dispatch =&gt;</div><div class="line">  <span class="built_in">Object</span>.keys(actionCreators).reduce(<span class="function">(<span class="params">actionDispatchers, name</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">var</span> actionCreator = actionCreators[name];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator == <span class="string">'function'</span>) &#123;</div><div class="line">      actionDispatchers[name] = <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(actionCreator(...args));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> actionDispatchers;</div><div class="line">  &#125;, &#123;&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> actionCreators = <span class="built_in">require</span>(<span class="string">'./ducks/widgets'</span>);</div><div class="line"><span class="keyword">var</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> state.widgets;</div><div class="line"><span class="keyword">var</span> mapDispatchToProps = createActionDispatchers(actionCreators);</div><div class="line"></div><div class="line"><span class="keyword">var</span> MyComponent = React.createClass(&#123; <span class="comment">/* ... */</span> &#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = connect(mapStateToProps , mapDispatchToProps)(MyComponent);</div></pre></td></tr></table></figure>

    
  </div>
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/04/20/常用的javascript设计模式/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2017/04/17/计算机网络基础知识总结/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">Close</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'forsigner';
    
    var disqus_url = 'http://yoursite.com/2017/04/19/redux学习笔记/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//forsigner.disqus.com/count.js" async></script>



    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
